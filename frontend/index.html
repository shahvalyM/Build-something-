<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Todo Micro - training</title>
</head>
<body>
  <h1>Todo - Training</h1>
  <input id="title" placeholder="Task title">
  <button id="add">Add</button>
  <ul id="list"></ul>

<script>
const API_BASE = 'http://127.0.0.1:8000';

async function listTasks(){
  try {
    const res = await fetch(`${API_BASE}/tasks`);
    const data = await res.json();
    const ul = document.getElementById('list');
    ul.innerHTML = '';
    for(const t of data){
      const li = document.createElement('li');
      li.innerText = t.title + ' ';
      const del = document.createElement('button');
      del.innerText = 'Delete';
      del.onclick = async ()=> {
        await fetch(`${API_BASE}/tasks/${t.id}`, { method: 'DELETE' });
        listTasks();
      };
      li.appendChild(del);
      ul.appendChild(li);
    }
  } catch (err) {
    console.error('Could not list tasks', err);
  }
}

document.getElementById('add').onclick = async ()=>{
  const title = document.getElementById('title').value;
  if(!title) return;
  await fetch(`${API_BASE}/tasks`, {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({title})
  });
  document.getElementById('title').value = '';
  listTasks();
}

listTasks();
</script>
</body>
</html>
